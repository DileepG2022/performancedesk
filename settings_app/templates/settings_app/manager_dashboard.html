{% extends 'base.html' %}

{% block content %}
<div class="container-fluid px-4">
    <h2 class="text-center mb-4 fw-bold">ðŸ“Š Manager Dashboard</h2>
    <div class="row mb-4">
  <div class="col-md-6 offset-md-3">
    <form method="get" class="d-flex">
      <select name="month" class="form-select me-2" onchange="this.form.submit()">
        <option value="">-- Select Review Month --</option>
        {% for m in months %}
          <option value="{{ m|date:'Y-m' }}" {% if selected_month and m|date:'Y-m' == selected_month|date:'Y-m' %}selected{% endif %}>
            {{ m|date:"F Y" }}
          </option>
        {% endfor %}
      </select>
      <button class="btn btn-primary">Go</button>
    </form>
  </div>
</div>

{% if summary %}
{% if summary.trainers %}
<div class="card shadow-lg mb-4">
  <div class="card-body">
    <h5 class="fw-bold text-primary mb-3">
      Trainer Reviews ({{ selected_month|date:"F Y" }})
    </h5>
    <div class="table-responsive">
      <table class="table table-bordered table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>Trainer</th>
            <th>Total Batches</th>
            <th>Submitted</th>
            <th>Pending</th>
            <th>Details</th>
          </tr>
        </thead>
        <tbody>
          {% for t in summary.trainers %}
          <tr>
            <td>{{ t.name }}</td>
            <td>{{ t.batches }}</td>
            <td class="text-success fw-bold">{{ t.submitted }}</td>
            <td class="text-danger fw-bold">{{ t.pending }}</td>
            <td>
              {% if t.pending > 0 %}
              <button class="btn btn-sm btn-outline-primary"
                      data-bs-toggle="collapse"
                      data-bs-target="#trainer{{ forloop.counter }}"
                      aria-expanded="false"
                      aria-controls="trainer{{ forloop.counter }}">
                Show Pending Batches
              </button>
              {% else %}
              <span class="badge bg-success">All Submitted</span>
              {% endif %}
            </td>
          </tr>
          {% if t.pending > 0 %}
          <tr class="collapse" id="trainer{{ forloop.counter }}">
            <td colspan="5">
              <ul class="list-group list-group-flush">
                {% for batch in t.pending_batches %}
                <li class="list-group-item">{{ batch }}</li>
                {% endfor %}
              </ul>
            </td>
          </tr>
          {% endif %}
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endif %}


<div class="row g-4">
  <!-- Trainers
  <div class="col-md-4">
    <div class="card shadow-lg border-0 rounded-4">
      <div class="card-body text-center">
        <h5 class="fw-bold text-primary">Trainer Reviews</h5>
        <canvas id="trainerChart"></canvas>
      </div>
    </div>
  </div> -->

  <!-- Sales -->
  <div class="col-md-6">
    <div class="card shadow-lg border-0 rounded-4">
      <div class="card-body text-center">
        <h5 class="fw-bold text-success">Sales Reviews</h5>
        <canvas id="salesChart"></canvas>
      </div>
    </div>
  </div>

  <div class="col-md-6">
    <div class="card shadow-lg border-0 rounded-4">
      <div class="card-body text-center">
        <h5 class="fw-bold text-warning">Placement Reviews</h5>
        <canvas id="placementChart"></canvas>
      </div>
    </div>
  </div>
</div>

<div class="row g-4 mt-2">
  <!-- Sales -->
  <div class="col-md-6">
    <div class="card shadow-lg mb-4">
      <div class="card-body">
        <h5 class="fw-bold text-success mb-3">
          Sales Reviews ({{ selected_month|date:"F Y" }})
        </h5>
        <div class="table-responsive">
          <table class="table table-bordered table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th>Sales Member</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {% for s in summary.sales.list %}
              <tr>
                <td>{{ s.name }}</td>
                <td>
                  {% if s.status == "Submitted" %}
                  <span class="badge bg-success">Submitted</span>
                  {% else %}
                  <span class="badge bg-danger">Pending</span>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Placement -->
  <div class="col-md-6">
    <div class="card shadow-lg mb-4">
      <div class="card-body">
        <h5 class="fw-bold text-warning mb-3">
          Placement Reviews ({{ selected_month|date:"F Y" }})
        </h5>
        <div class="table-responsive">
          <table class="table table-bordered table-hover align-middle">
            <thead class="table-light">
              <tr>
                <th>Placement Member</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              {% for p in summary.placement.list %}
              <tr>
                <td>{{ p.name }}</td>
                <td>
                  {% if p.status == "Submitted" %}
                  <span class="badge bg-success">Submitted</span>
                  {% else %}
                  <span class="badge bg-danger">Pending</span>
                  {% endif %}
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

{% endif %}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
{% if summary.sales %}
  new Chart(document.getElementById('salesChart'), {
    type: 'doughnut',
    data: {
      labels: ['Submitted', 'Pending'],
      datasets: [{
        data: [{{ summary.sales.submitted }}, {{ summary.sales.pending }}],
        backgroundColor: ['#43e97b', '#ff6a9e']
      }]
    }
  });
{% endif %}

{% if summary.placement %}
  new Chart(document.getElementById('placementChart'), {
    type: 'doughnut',
    data: {
      labels: ['Submitted', 'Pending'],
      datasets: [{
        data: [{{ summary.placement.submitted }}, {{ summary.placement.pending }}],
        backgroundColor: ['#667eea', '#ffb347']
      }]
    }
  });
{% endif %}
</script>


    <!-- Row 1: Charts -->
    <!-- <div class="row g-4 mb-4">
        <div class="col-lg-6">
            <div class="card shadow-lg border-0 rounded-4">
                <div class="card-body">
                    <h5 class="card-title text-primary fw-bold">Batch Distribution</h5>
                    <canvas id="batchChart"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card shadow-lg border-0 rounded-4">
                <div class="card-body">
                    <h5 class="card-title text-success fw-bold">Monthly Reviews Trend</h5>
                    <canvas id="reviewChart"></canvas>
                </div>
            </div>
        </div>
    </div> -->

    <!-- Row 2: Quick Links -->
    <div class="row g-4 mt-2">
        <!-- Manage Course -->
        <div class="col-md-4">
    <div class="card shadow-lg border-0 rounded-4 h-100 text-dark" style="background: linear-gradient(135deg, #e0f7fa, #b2ebf2);">
        <div class="card-body text-center">
            <i class="bi bi-book-half display-4 text-primary"></i>
            <h5 class="card-title mt-3">Manage Courses</h5>
            <p class="card-text">Add, Edit or Delete Courses</p>
            <a href="{% url 'course_list' %}" class="btn btn-light btn-sm">Go to Courses</a>
        </div>
    </div>
</div>


        <!-- Manage Branch -->
        <div class="col-md-4">
            <div class="card shadow-lg border-0 rounded-4 h-100 text-white" style="background: linear-gradient(135deg, #43e97b, #38f9d7);">
                <div class="card-body text-center">
                    <i class="bi bi-building display-4"></i>
                    <h5 class="card-title mt-3">Manage Branches</h5>
                    <p class="card-text">Add, Edit or Delete Branches</p>
                    <a href="{% url 'branch_list' %}" class="btn btn-light btn-sm">Go to Branches</a>
                </div>
            </div>
        </div>

        <!-- Manage Batch -->
        <div class="col-md-4">
            <div class="card shadow-lg border-0 rounded-4 h-100 text-white" style="background: linear-gradient(135deg, #ff9a9e, #fad0c4);">
                <div class="card-body text-center">
                    <i class="bi bi-people-fill display-4"></i>
                    <h5 class="card-title mt-3">Manage Batches</h5>
                    <p class="card-text">View and assign Faculty to Batches</p>
                    <a href="{% url 'batch_list' %}" class="btn btn-light btn-sm">Go to Batches</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Row 3: More Options -->
    <div class="row g-4 mt-2">
        <div class="col-md-4">
            <div class="card shadow-lg border-0 rounded-4 h-100 text-white" style="background: linear-gradient(135deg, #a18cd1, #fbc2eb);">
                <div class="card-body text-center">
                    <i class="bi bi-person-badge-fill display-4"></i>
                    <h5 class="card-title mt-3">Manage Faculty</h5>
                    <p class="card-text">Add and assign Faculty to Courses & Batches</p>
                    <a href="{% url 'faculty_list' %}" class="btn btn-light btn-sm">Go to Faculty</a>
                </div>
            </div>
        </div>

        <!-- Trainer Reviews -->
        <div class="col-md-4">
            <div class="card shadow-lg border-0 rounded-4 h-100 text-white" style="background: linear-gradient(135deg, #ffecd2, #fcb69f);">
                <div class="card-body text-center">
                    <i class="bi bi-journal-check display-4"></i>
                    <h5 class="card-title mt-3">Trainer Review Summary</h5>
                    <p class="card-text">View all reviews of a Trainer by Batch</p>
                    <a href="{% url 'all_month_reviews' %}" class="btn btn-light btn-sm">View Reviews</a>
                </div>
            </div>
        </div>

        <!-- Sales Management -->
        <div class="col-md-4">
            <div class="card shadow-lg border-0 rounded-4 h-100 text-white" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                <div class="card-body text-center">
                    <i class="bi bi-bar-chart-line-fill display-4"></i>
                    <h5 class="card-title mt-3">Manage Sales</h5>
                    <p class="card-text">Add, Edit or Delete Sales Staff</p>
                    <a href="{% url 'sales_list' %}" class="btn btn-light btn-sm">Go to Sales</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Row 4: Placement -->
    <div class="row g-4 mt-2">
        <div class="col-md-4">
            <div class="card shadow-lg border-0 rounded-4 h-100 text-white" style="background: linear-gradient(135deg, #ff6a00, #ee0979);">
                <div class="card-body text-center">
                    <i class="bi bi-briefcase-fill display-4"></i>
                    <h5 class="card-title mt-3">Manage Placement</h5>
                    <p class="card-text">Add, Edit or Delete Placement Staff</p>
                    <a href="{% url 'placement_list' %}" class="btn btn-light btn-sm">Go to Placement</a>
                </div>
            </div>
        </div>

        <!-- Placement Reviews -->
        <div class="col-md-4">
            <div class="card shadow-lg border-0 rounded-4 h-100 text-white" style="background: linear-gradient(135deg, #36d1dc, #5b86e5);">
                <div class="card-body text-center">
                    <i class="bi bi-clipboard-data-fill display-4"></i>
                    <h5 class="card-title mt-3">Placement Review Summary</h5>
                    <p class="card-text">View all reviews of Placement Team</p>
                    <a href="{% url 'placement_all_months_review_report' %}" class="btn btn-light btn-sm">View Reviews</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Example batch distribution chart
    // const ctx1 = document.getElementById('batchChart');
    // new Chart(ctx1, {
    //     type: 'pie',
    //     data: {
    //         labels: ['Ongoing', 'Completed', 'Upcoming'],
    //         datasets: [{
    //             data: [12, 8, 5],
    //             backgroundColor: ['#4facfe', '#43e97b', '#ff9a9e']
    //         }]
    //     }
    // });

    // Example review trend chart
    // const ctx2 = document.getElementById('reviewChart');
    // new Chart(ctx2, {
    //     type: 'line',
    //     data: {
    //         labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
    //         datasets: [{
    //             label: 'Monthly Reviews',
    //             data: [5, 9, 7, 11, 8, 10],
    //             borderColor: '#36d1dc',
    //             tension: 0.4,
    //             fill: true,
    //             backgroundColor: 'rgba(54,209,220,0.2)'
    //         }]
    //     }
    // });
</script>
{% endblock %}
